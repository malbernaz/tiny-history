{"version":3,"file":"tiny-history.js","sources":["../index.js"],"sourcesContent":["let a = document.createElement(\"a\");\n\nfunction parseURL(href) {\n  a.href = href;\n\n  let pathname = (a.pathname || location.pathname)\n    .split(\"/\")\n    .filter(Boolean)\n    .join(\"/\");\n\n  return {\n    pathname: `/${pathname}`,\n    search: a.search,\n    hash: a.hash\n  };\n}\n\nfunction createLocation(path, state) {\n  let newLocation = { state: state || null };\n\n  let newURL;\n  if (path === undefined) {\n    newURL = parseURL(location.href);\n  } else {\n    let key = Math.random()\n      .toString(36)\n      .substr(2, 5);\n    newURL = parseURL(path);\n    newLocation.key = key;\n  }\n\n  newLocation.pathname = newURL.pathname;\n  newLocation.search = newURL.search;\n  newLocation.hash = newURL.hash;\n\n  return newLocation;\n}\n\nexport default function createHistory() {\n  let listeners = [];\n  let location = createLocation();\n  let entries = [location];\n\n  function handlePopState({ state }) {\n    location = state || entries[0];\n    listeners.forEach(listener => listener(location, \"POP\"));\n  }\n\n  function listen(listener) {\n    if (typeof listener !== \"function\") {\n      throw new Error(\"listener must be a function\");\n    }\n\n    listeners.push(listener);\n\n    if (listeners.length === 1) {\n      addEventListener(\"popstate\", handlePopState, false);\n    }\n\n    return () => {\n      listeners = listeners.filter((l, i) => i !== listeners.indexOf(listener));\n\n      if (!listeners.length) {\n        removeEventListener(\"popstate\", handlePopState);\n      }\n    };\n  }\n\n  function push(path, state) {\n    location = createLocation(path, state);\n    entries.push(location);\n    history.pushState(location, null, path);\n    listeners.forEach(listener => listener(location, \"PUSH\"));\n  }\n\n  function replace(path, state) {\n    location = createLocation(path, state);\n    entries.pop();\n    entries.push(location);\n    history.replaceState(location, null, path);\n    listeners.forEach(listener => listener(location, \"REPLACE\"));\n  }\n\n  return {\n    go: index => history.go(index),\n    back: () => history.back(),\n    forward: () => history.forward(),\n    get length() {\n      return entries.length;\n    },\n    get location() {\n      return location;\n    },\n    listen,\n    push,\n    replace\n  };\n}\n"],"names":["parseURL","href","a","pathname","location","split","filter","Boolean","join","search","hash","createLocation","path","state","let","newURL","newLocation","undefined","key","Math","random","toString","substr","createHistory","handlePopState","ref","entries","listeners","forEach","listener","listen","Error","push","length","addEventListener","l","i","indexOf","removeEventListener","history","pushState","replace","pop","replaceState","go","index","back","forward","document","createElement"],"mappings":"yCAEA,SAASA,GAASC,GAQhB,MAPAC,GAAED,KAAOA,GAQPE,SAAU,KANID,EAAEC,UAAYC,SAASD,UACpCE,MAAM,KACNC,OAAOC,SACPC,KAAK,KAINC,OAAQP,EAAEO,OACVC,KAAMR,EAAEQ,MAIZ,QAASC,GAAeC,EAAMC,GAC5BC,GAEIC,GAFAC,GAAgBH,MAAOA,GAAS,KAGpC,QAAaI,KAATL,EACFG,EAASf,EAASI,SAASH,UACtB,CACLa,GAAII,GAAMC,KAAKC,SACZC,SAAS,IACTC,OAAO,EAAG,EACbP,GAASf,EAASY,GAClBI,EAAYE,IAAMA,EAOpB,MAJAF,GAAYb,SAAWY,EAAOZ,SAC9Ba,EAAYP,OAASM,EAAON,OAC5BO,EAAYN,KAAOK,EAAOL,KAEnBM,EAGT,QAAwBO,KAKtB,QAASC,GAAeC,GACtBrB,WAAoBsB,EAAQ,GAC5BC,EAAUC,QAAQ,SAAAC,SAAYA,GAASzB,EAAU,SAGnD,QAAS0B,GAAOD,GACd,GAAwB,kBAAbA,GACT,KAAUE,OAAM,8BASlB,OANAJ,GAAUK,KAAKH,GAEU,IAArBF,EAAUM,QACZC,iBAAiB,WAAYV,GAAgB,GAGxC,YACLG,EAAYA,EAAUrB,OAAO,SAAC6B,EAAGC,SAAMA,KAAMT,EAAUU,QAAQR,MAEhDI,QACbK,oBAAoB,WAAYd,IAKtC,QAASQ,GAAKpB,EAAMC,GAClBT,EAAWO,EAAeC,EAAMC,GAChCa,EAAQM,KAAK5B,GACbmC,QAAQC,UAAUpC,EAAU,KAAMQ,GAClCe,EAAUC,QAAQ,SAAAC,SAAYA,GAASzB,EAAU,UAGnD,QAASqC,GAAQ7B,EAAMC,GACrBT,EAAWO,EAAeC,EAAMC,GAChCa,EAAQgB,MACRhB,EAAQM,KAAK5B,GACbmC,QAAQI,aAAavC,EAAU,KAAMQ,GACrCe,EAAUC,QAAQ,SAAAC,SAAYA,GAASzB,EAAU,aAzCnDU,GAAIa,MACAvB,EAAWO,IACXe,GAAWtB,EA0Cf,QACEwC,GAAI,SAAAC,SAASN,SAAQK,GAAGC,IACxBC,KAAM,iBAAMP,SAAQO,QACpBC,QAAS,iBAAMR,SAAQQ,WACvBd,aACE,MAAOP,GAAQO,QAEjB7B,eACE,MAAOA,IAET0B,OAAAA,EACAE,KAAAA,EACAS,QAAAA,GA/FJ3B,GAAIZ,GAAI8C,SAASC,cAAc"}