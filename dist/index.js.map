{"version":3,"file":"index.js","sources":["../index.js"],"sourcesContent":["function createURL(path) {\n  try {\n    const url = path ? new URL(path, location) : new URL(location);\n    if (!url.pathname) throw new Error();\n    return url;\n  } catch (error) {\n    const link = document.createElement(\"a\");\n    link.href = path || location.href;\n    const pathname = (!!path && !link.pathname ? location.pathname : link.pathname)\n      .split(\"/\")\n      .filter(Boolean)\n      .join(\"/\");\n\n    return {\n      pathname: `/${pathname}`,\n      search: link.search,\n      hash: link.hash\n    };\n  }\n}\n\nexport default class BrowserHistory {\n  constructor() {\n    this.listeners = [];\n    this.location = this.createLocation();\n    this.entries = [this.location];\n\n    this.go = index => history.go(index);\n    this.back = () => history.back();\n    this.forward = () => history.forward();\n\n    this.handlePopState = ({ state }) => {\n      this.location = state || this.entries[0];\n      this.listeners.forEach(listener => listener(this.location, \"POP\"));\n    };\n\n    this.firstLocation = true;\n  }\n\n  get length() {\n    return this.entries.length;\n  }\n\n  listen(listener) {\n    if (typeof listener !== \"function\") {\n      throw new Error(\"listener must be a function\");\n    }\n\n    this.listeners.push(listener);\n\n    if (this.listeners.length === 1) {\n      addEventListener(\"popstate\", this.handlePopState, false);\n    }\n\n    return () => {\n      this.listeners = this.listeners.filter((l, i) => i !== this.listeners.indexOf(listener));\n\n      if (!this.listeners.length) {\n        removeEventListener(\"popstate\", this.handlePopState);\n      }\n    };\n  }\n\n  createLocation(path, state) {\n    const newLocation = { state: state || null };\n\n    let newURL;\n    if (path === undefined) {\n      newURL = createURL();\n    } else {\n      const key = Math.random().toString(36).substr(2, 5);\n      newURL = createURL(path);\n      newLocation.key = key;\n    }\n\n    newLocation.pathname = newURL.pathname;\n    newLocation.search = newURL.search;\n    newLocation.hash = newURL.hash;\n\n    return newLocation;\n  }\n\n  push(path, state) {\n    this.location = this.createLocation(path, state);\n    this.entries.push(this.location);\n    history.pushState(this.location, null, path);\n    this.listeners.forEach(listener => listener(this.location, \"PUSH\"));\n  }\n\n  replace(path, state) {\n    this.location = this.createLocation(path, state);\n    this.entries.pop();\n    this.entries.push(this.location);\n    history.replaceState(this.location, null, path);\n    this.listeners.forEach(listener => listener(this.location, \"REPLACE\"));\n  }\n}\n"],"names":["createURL","path","const","url","URL","location","pathname","Error","error","link","document","createElement","href","split","filter","Boolean","join","search","hash","BrowserHistory","this","listeners","createLocation","entries","go","index","history","back","forward","handlePopState","ref","state","this$1","forEach","listener","firstLocation","prototypeAccessors","length","listen","push","addEventListener","l","i","indexOf","removeEventListener","newURL","newLocation","undefined","key","Math","random","toString","substr","pushState","replace","pop","replaceState"],"mappings":"mLAAA,SAASA,EAAUC,GACjB,IACEC,IAAMC,EAAMF,EAAO,IAAIG,IAAIH,EAAMI,UAAY,IAAID,IAAIC,UACrD,IAAKF,EAAIG,SAAU,MAAUC,QAC7B,OAAOJ,EACP,MAAOK,GACPN,IAAMO,EAAOC,SAASC,cAAc,KAOpC,OANAF,EAAKG,KAAOX,GAAQI,SAASO,MAO3BN,SAAU,KANQL,IAASQ,EAAKH,SAAWD,SAASC,SAAWG,EAAKH,UACnEO,MAAM,KACNC,OAAOC,SACPC,KAAK,KAINC,OAAQR,EAAKQ,OACbC,KAAMT,EAAKS,OAKjB,IAAqBC,EAAe,sBAElCC,KAAOC,aACPD,KAAOf,SAAWe,KAAKE,iBACvBF,KAAOG,SAAWH,KAAKf,UAEvBe,KAAOI,GAAK,SAAAC,UAASC,QAAQF,GAAGC,IAChCL,KAAOO,KAAO,kBAAMD,QAAQC,QAC5BP,KAAOQ,QAAU,kBAAMF,QAAQE,WAE/BR,KAAOS,eAAiB,SAACC,OAAEC,UACzBC,EAAO3B,SAAW0B,GAASX,EAAKG,QAAQ,GACxCS,EAAOX,UAAUY,QAAQ,SAAAC,UAAYA,EAASd,EAAKf,SAAU,UAG/De,KAAOe,eAAgB,wBAGzBC,EAAEC,sBACA,OAASjB,KAAKG,QAAQc,QAGxBlB,YAAEmB,gBAAOJ,cACP,GAA0B,mBAAbA,EACX,MAAY3B,MAAM,+BASpB,OANAa,KAAOC,UAAUkB,KAAKL,GAEU,IAA1Bd,KAAKC,UAAUgB,QACnBG,iBAAmB,WAAYpB,KAAKS,gBAAgB,GAG7C,WACPG,EAAOX,UAAYD,EAAKC,UAAUP,OAAO,SAAC2B,EAAGC,UAAMA,IAAMtB,EAAKC,UAAUsB,QAAQT,KAEzEd,EAAKC,UAAUgB,QACpBO,oBAAsB,WAAYxB,EAAKS,kBAK7CV,YAAEG,wBAAerB,EAAM8B,GACrB,IAEMc,EAFEC,GAAgBf,MAAOA,GAAS,MAGxC,QAAegB,IAAT9C,EACJ4C,EAAW7C,QACJ,CACP,IAAQgD,EAAMC,KAAKC,SAASC,SAAS,IAAIC,OAAO,EAAG,GACnDP,EAAW7C,EAAUC,GACrB6C,EAAcE,IAAMA,EAOtB,OAJAF,EAAcxC,SAAWuC,EAAOvC,SAChCwC,EAAc7B,OAAS4B,EAAO5B,OAC9B6B,EAAc5B,KAAO2B,EAAO3B,KAEnB4B,GAGX3B,YAAEoB,cAAKtC,EAAM8B,cACXX,KAAOf,SAAWe,KAAKE,eAAerB,EAAM8B,GAC5CX,KAAOG,QAAQgB,KAAKnB,KAAKf,UACzBqB,QAAU2B,UAAUjC,KAAKf,SAAU,KAAMJ,GACzCmB,KAAOC,UAAUY,QAAQ,SAAAC,UAAYA,EAASd,EAAKf,SAAU,WAG/Dc,YAAEmC,iBAAQrD,EAAM8B,cACdX,KAAOf,SAAWe,KAAKE,eAAerB,EAAM8B,GAC5CX,KAAOG,QAAQgC,MACfnC,KAAOG,QAAQgB,KAAKnB,KAAKf,UACzBqB,QAAU8B,aAAapC,KAAKf,SAAU,KAAMJ,GAC5CmB,KAAOC,UAAUY,QAAQ,SAAAC,UAAYA,EAASd,EAAKf,SAAU"}