{"version":3,"file":"index.js","sources":["../createLocation.js","../index.js"],"sourcesContent":["function createURL(path) {\n  try {\n    const url = path ? new URL(path, location) : new URL(location);\n    if (!url.pathname) throw new Error();\n    return url;\n  } catch (error) {\n    const link = document.createElement(\"a\");\n    link.href = path || location.href;\n\n    const pathname = (!!path && !link.pathname ? location.pathname : link.pathname)\n      .split(\"/\")\n      .filter(Boolean)\n      .join(\"/\");\n\n    return {\n      pathname: `/${pathname}`,\n      search: link.search,\n      hash: link.hash\n    };\n  }\n}\n\nexport default function createLocation(path, state) {\n  const newLocation = { state: state || null };\n\n  let newURL;\n  if (path === undefined) {\n    newURL = createURL();\n  } else {\n    const key = Math.random().toString(36).substr(2, 5);\n    newURL = createURL(path);\n    newLocation.key = key;\n  }\n\n  newLocation.pathname = newURL.pathname;\n  newLocation.search = newURL.search;\n  newLocation.hash = newURL.hash;\n\n  return newLocation;\n}\n","import createLocation from \"./createLocation\";\n\nexport default class TinyHistory {\n  constructor() {\n    this.listeners = [];\n    this.location = createLocation();\n    this.entries = [this.location];\n\n    this.go = index => history.go(index);\n    this.goBack = () => history.back();\n    this.goForward = () => history.forward();\n\n    this.handlePopState = ({ state }) => {\n      this.location = state || this.entries[0];\n      this.listeners.forEach(listener => listener(this.location, \"POP\"));\n    };\n\n    this.firstLocation = true;\n  }\n\n  get length() {\n    return this.entries.length;\n  }\n\n  listen(listener) {\n    if (typeof listener !== \"function\") {\n      throw new Error(\"listener must be a function\");\n    }\n\n    this.listeners.push(listener);\n\n    if (this.listeners.length === 1) {\n      addEventListener(\"popstate\", this.handlePopState, false);\n    }\n\n    return () => {\n      this.listeners = this.listeners.filter((l, i) => i !== this.listeners.indexOf(listener));\n\n      if (!this.listeners.length) {\n        removeEventListener(\"popstate\", this.handlePopState);\n      }\n    };\n  }\n\n  push(path, state) {\n    this.location = createLocation(path, state);\n    this.entries.push(this.location);\n    history.pushState(this.location, null, path);\n    this.listeners.forEach(listener => listener(this.location, \"PUSH\"));\n  }\n\n  replace(path, state) {\n    this.location = createLocation(path, state);\n    this.entries.pop();\n    this.entries.push(this.location);\n    history.replaceState(this.location, null, path);\n    this.listeners.forEach(listener => listener(this.location, \"REPLACE\"));\n  }\n}\n"],"names":["createURL","path","const","url","URL","location","pathname","Error","error","link","document","createElement","href","split","filter","Boolean","join","search","hash","createLocation","state","newURL","newLocation","undefined","key","Math","random","toString","substr","TinyHistory","this","listeners","entries","go","index","history","goBack","back","goForward","forward","handlePopState","ref","this$1","forEach","listener","firstLocation","prototypeAccessors","length","listen","push","addEventListener","l","i","indexOf","removeEventListener","pushState","replace","pop","replaceState"],"mappings":"aAAA,SAASA,UAAUC,GACjB,IACEC,IAAMC,EAAMF,EAAO,IAAIG,IAAIH,EAAMI,UAAY,IAAID,IAAIC,UACrD,IAAKF,EAAIG,SAAU,MAAUC,QAC7B,OAAOJ,EACP,MAAOK,GACPN,IAAMO,EAAOC,SAASC,cAAc,KAQpC,OAPAF,EAAKG,KAAOX,GAAQI,SAASO,MAQ3BN,SAAU,KANQL,IAASQ,EAAKH,SAAWD,SAASC,SAAWG,EAAKH,UACnEO,MAAM,KACNC,OAAOC,SACPC,KAAK,KAINC,OAAQR,EAAKQ,OACbC,KAAMT,EAAKS,OAKjB,SAAwBC,eAAelB,EAAMmB,GAC3ClB,IAEImB,EAFEC,GAAgBF,MAAOA,GAAS,MAGtC,QAAaG,IAATtB,EACFoB,EAASrB,gBACJ,CACLE,IAAMsB,EAAMC,KAAKC,SAASC,SAAS,IAAIC,OAAO,EAAG,GACjDP,EAASrB,UAAUC,GACnBqB,EAAYE,IAAMA,EAOpB,OAJAF,EAAYhB,SAAWe,EAAOf,SAC9BgB,EAAYL,OAASI,EAAOJ,OAC5BK,EAAYJ,KAAOG,EAAOH,KAEnBI,ECpCT,IAAqBO,YAAY,sBAE/BC,KAAOC,aACPD,KAAOzB,SAAWc,iBAClBW,KAAOE,SAAWF,KAAKzB,UAEvByB,KAAOG,GAAK,SAAAC,UAASC,QAAQF,GAAGC,IAChCJ,KAAOM,OAAS,kBAAMD,QAAQE,QAC9BP,KAAOQ,UAAY,kBAAMH,QAAQI,WAEjCT,KAAOU,eAAiB,SAACC,OAAErB,UACzBsB,EAAOrC,SAAWe,GAASU,EAAKE,QAAQ,GACxCU,EAAOX,UAAUY,QAAQ,SAAAC,UAAYA,EAASd,EAAKzB,SAAU,UAG/DyB,KAAOe,eAAgB,kCAGzBC,mBAAEC,sBACA,OAASjB,KAAKE,QAAQe,QAGxBlB,sBAAEmB,gBAAOJ,cACP,GAA0B,mBAAbA,EACX,MAAYrC,MAAM,+BASpB,OANAuB,KAAOC,UAAUkB,KAAKL,GAEU,IAA1Bd,KAAKC,UAAUgB,QACnBG,iBAAmB,WAAYpB,KAAKU,gBAAgB,GAG7C,WACPE,EAAOX,UAAYD,EAAKC,UAAUjB,OAAO,SAACqC,EAAGC,UAAMA,IAAMtB,EAAKC,UAAUsB,QAAQT,KAEzEd,EAAKC,UAAUgB,QACpBO,oBAAsB,WAAYxB,EAAKU,kBAK7CX,sBAAEoB,cAAKhD,EAAMmB,cACXU,KAAOzB,SAAWc,eAAelB,EAAMmB,GACvCU,KAAOE,QAAQiB,KAAKnB,KAAKzB,UACzB8B,QAAUoB,UAAUzB,KAAKzB,SAAU,KAAMJ,GACzC6B,KAAOC,UAAUY,QAAQ,SAAAC,UAAYA,EAASd,EAAKzB,SAAU,WAG/DwB,sBAAE2B,iBAAQvD,EAAMmB,cACdU,KAAOzB,SAAWc,eAAelB,EAAMmB,GACvCU,KAAOE,QAAQyB,MACf3B,KAAOE,QAAQiB,KAAKnB,KAAKzB,UACzB8B,QAAUuB,aAAa5B,KAAKzB,SAAU,KAAMJ,GAC5C6B,KAAOC,UAAUY,QAAQ,SAAAC,UAAYA,EAASd,EAAKzB,SAAU"}